<section
  class="py-10 px-4 sm:px-6 lg:px-8 bg-white dark:bg-neutral-950 transition-colors duration-300"
>
  <div class="mx-auto max-w-[110rem] w-full">
    @for (seller of groupedProducts; track seller?.user_email) {
    <div class="mb-12 border-b border-gray-200 dark:border-neutral-800 pb-8">
      <!-- Seller Header -->
      <div class="flex items-center justify-between mb-6">
        <div class="flex items-center gap-3">
          <img
            [src]="
              seller.user_profile_img ||
              'https://images.unsplash.com/photo-1603415526960-f7e0328c63b1?auto=format&fit=crop&w=400&q=60'
            "
            class="w-12 h-12 rounded-full object-cover ring-2 ring-indigo-100 dark:ring-amber-200/40"
            alt="Seller"
          />
          <div>
            <p
              class="font-semibold text-gray-900 dark:text-neutral-100 text-lg"
            >
              {{ seller.user_first_name }} {{ seller.user_last_name }}
            </p>
            <p class="text-sm text-gray-500 dark:text-neutral-400">
              {{ seller.user_email }}
            </p>
          </div>
        </div>

        <!-- 3-dot menu -->
        <button
          class="text-gray-500 hover:text-indigo-600 dark:text-neutral-400 dark:hover:text-amber-300 focus:outline-none transition"
          title="More options"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="currentColor"
            viewBox="0 0 24 24"
            class="w-6 h-6"
          >
            <circle cx="5" cy="12" r="1.5" />
            <circle cx="12" cy="12" r="1.5" />
            <circle cx="19" cy="12" r="1.5" />
          </svg>
        </button>
      </div>

      <!-- Product Swiper -->
      <swiper-container
        slides-per-view="3"
        pagination="true"
        mousewheel='{"forceToAxis": true, "sensitivity": 0.8}'
        class="mySwiper"
        style="
        --swiper-pagination-color: #4f46e5;
      "
        breakpoints='{
    "0": { "slidesPerView": 1 },
    "640": { "slidesPerView": 2 },
    "1024": { "slidesPerView": 3 }
  }'
      >
        @for (product of seller.products; track product._id) {
        <swiper-slide>
          <div
            class="mb-8 mx-3 group rounded-xl bg-white dark:bg-neutral-900 shadow-sm hover:shadow-lg border border-gray-100 dark:border-neutral-800 transition-all duration-300 overflow-hidden"
          >
            <div class="relative overflow-hidden rounded-t-xl">
              <!-- Product Image -->
              <img
                [src]="
                  product.product_img ||
                  'https://images.unsplash.com/photo-1519710164239-da123dc03ef4?auto=format&fit=crop&w=800&q=80'
                "
                alt="{{ product.product_title }}"
                class="h-[350px] sm:h-[420px] w-full object-cover transition-transform duration-500 group-hover:scale-[1.02]"
              />

              <!-- Hover Buttons (no dark layer) -->
              <div
                class="absolute inset-0 flex flex-col items-center justify-center gap-3 opacity-0 group-hover:opacity-100 translate-y-4 group-hover:translate-y-0 transition-all duration-300"
              >
                <button
                  class="w-2/3 py-2 bg-[#4F46E5] text-white font-semibold rounded-md shadow-md hover:bg-[#4338CA] dark:bg-[#FFE135] dark:text-black dark:hover:bg-[#E6C92F] transition-all duration-300"
                  (click)="addToCart(product._id)"
                >
                  Buy Now
                </button>

                <a
                  [routerLink]="['/view-detail-page', product._id]"
                  class="w-2/3 text-center py-2 bg-white/90 dark:bg-neutral-900/90 border border-gray-200 dark:border-neutral-700 text-gray-900 dark:text-neutral-100 font-semibold rounded-md shadow-md hover:bg-gray-100 dark:hover:bg-neutral-800 transition-all duration-300"
                >
                  View Detail
                </a>
              </div>
            </div>

            <!-- Product Info -->
            <div class="p-5">
              <h3
                class="text-base font-semibold text-gray-900 dark:text-neutral-100 group-hover:text-indigo-600 dark:group-hover:text-amber-300 transition"
              >
                {{ product.product_title }}
              </h3>
              <p
                class="mt-1 text-gray-700 dark:text-neutral-300 text-sm line-clamp-2"
              >
                {{ product.product_desc }}
              </p>
              <p class="mt-2 text-lg text-indigo-600 dark:text-amber-300">
                ${{ product.product_price }}
              </p>

              <!-- Interaction Bar -->
              <div class="mt-4 flex items-center justify-between">
                <div class="flex items-center gap-3">
                  <!-- Like -->
                  <button
                    (click)="toggleLike(product)"
                    class="focus:outline-none transition transform hover:scale-110"
                  >
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      [attr.fill]="product.liked ? '#ef4444' : 'none'"
                      viewBox="0 0 24 24"
                      stroke-width="1.8"
                      stroke="currentColor"
                      class="w-6 h-6 text-gray-600 dark:text-neutral-400"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        d="M21 8.25c0-2.485-2.015-4.5-4.5-4.5-1.74 0-3.223 1.003-3.97 2.477C11.723 4.753 10.24 3.75 8.5 3.75 6.015 3.75 4 5.765 4 8.25c0 7.236 8 11.25 8 11.25s8-4.014 8-11.25z"
                      />
                    </svg>
                  </button>

                  <!-- Comment -->
                  <button
                    (click)="toggleComments(product)"
                    class="focus:outline-none transition transform hover:scale-110"
                  >
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="1.8"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      class="w-6 h-6 text-gray-600 dark:text-neutral-400 hover:text-indigo-600 dark:hover:text-amber-300 transition-colors"
                    >
                      <path
                        d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.5 8.5 0 0 1 8 8.5Z"
                      />
                    </svg>
                  </button>
                </div>
                <p
                  class="text-sm font-semibold text-gray-700 dark:text-neutral-300"
                >
                  {{ product.likes_count }} likes
                </p>
              </div>

              <!-- Comments Section -->
              <div
                class="mt-3 border-t border-gray-200 dark:border-neutral-800 pt-3"
              >
                <button
                  (click)="toggleComments(product)"
                  class="text-sm text-gray-500 dark:text-neutral-400 hover:underline"
                >
                  @if (product.showComments) { Hide comments } @else if
                  ((product.comments_count || 0) === 0) { No comments yet! Click
                  to leave one! } @else if ((product.comments_count || 0) > 50)
                  { View 50+ comments } @else { View
                  {{ product.comments_count || 0 }} comments }
                </button>

                @if (product.showComments) {
                <div
                  class="mt-3 max-h-60 overflow-y-auto border rounded-lg p-3 bg-gray-50 dark:bg-neutral-800 scrollbar-thin scrollbar-thumb-gray-300 dark:scrollbar-thumb-neutral-600"
                >
                  @for (comment of product.comments; track comment._id) {
                  <div class="text-sm text-gray-700 dark:text-neutral-200 mb-2">
                    <span
                      class="font-semibold text-gray-900 dark:text-neutral-100"
                      >{{ comment.user_id?.user_first_name }}:</span
                    >
                    {{ comment.text }}
                  </div>
                  }

                  <!-- Add Comment -->
                  <div class="flex items-center mt-2">
                    <input
                      [(ngModel)]="product.new_comment"
                      placeholder="Add a comment..."
                      class="flex-1 border border-gray-300 dark:border-neutral-700 rounded-lg px-3 py-1 text-sm bg-white dark:bg-neutral-900 text-gray-800 dark:text-neutral-100 focus:ring-2 focus:ring-indigo-300 dark:focus:ring-amber-300"
                    />
                    <button
                      (click)="addComment(product)"
                      [disabled]="
                        !product.new_comment || !product.new_comment.trim()
                      "
                      class="ml-2 text-indigo-600 dark:text-amber-300 text-sm font-semibold hover:underline disabled:text-gray-400 disabled:cursor-not-allowed"
                    >
                      Post
                    </button>
                  </div>
                </div>
                }
              </div>
            </div>
          </div>
        </swiper-slide>
        }
      </swiper-container>
    </div>
    }
  </div>
</section>
